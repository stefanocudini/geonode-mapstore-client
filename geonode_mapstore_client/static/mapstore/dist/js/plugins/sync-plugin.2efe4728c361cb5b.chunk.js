"use strict";(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[73731],{460573:(t,r,e)=>{e.r(r),e.d(r,{ConnectedSyncButton:()=>B,default:()=>G});var n=e(273517),o=e.n(n),i=e(605556),a=e.n(i),u=e(811668),c=e(801081),l=e(393149),s=e(8571),f=e(836970),p=e(501719),y=e(45388),b=e(995531),m=e(355364),v=e.n(m),d=e(763375),g=e.n(d),h="GEONODE:SYNC_RESOURCES",O=e(903235),w=e(172175),j=e(794689),S=e(958496),P=e(883832),E=e(425380),k=e(589769),T=e(985564);function A(t){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},A(t)}function D(t){return function(t){if(Array.isArray(t))return M(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||C(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(t,r){if(t){if("string"==typeof t)return M(t,r);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?M(t,r):void 0}}function M(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=Array(r);e<r;e++)n[e]=t[e];return n}function z(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),e.push.apply(e,n)}return e}function I(t){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{};r%2?z(Object(e),!0).forEach((function(r){_(t,r,e[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):z(Object(e)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}))}return t}function _(t,r,e){return(r=function(t){var r=function(t){if("object"!=A(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var e=r.call(t,"string");if("object"!=A(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==A(r)?r:r+""}(r))in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}var N=function(t,r){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if("geostory"===t){var n=r.subtype||r.resource_type;return{type:n,data:"map"!==n?(0,E.jM)(r,r):(0,E.kN)(r)}}if("dashboard"===t){var o,i=null===(o=r.widgets)||void 0===o?void 0:o.map((function(t){if("map"===t.widgetType&&t.maps)return I(I({},t),{},{maps:t.maps.map((function(t){var r=e.find((function(r){var e;return!(r.data.pk!==(null==t||null===(e=t.extraParams)||void 0===e?void 0:e.pk))}));return r?I(I({},t),r.data.data.map):t}))});var r=e.find((function(r){var e;return!(r.data.pk!==(null===(e=t.map)||void 0===e||null===(e=e.extraParams)||void 0===e?void 0:e.pk))}));return r?I(I({},t),{},{map:I(I({},t.map),r.data.data.map)}):t}));return{data:v()(r,{widgets:i})}}return{}};const R={gnSyncComponentsWithResources:function(t,r){return t.ofType(h).switchMap((function(){var t=r.getState(),e=(0,w.H2)(t),n=function(t,r){switch(t){case"geostory":return(0,w.c2)(r);case"dashboard":return(0,w.MP)(r);default:return[]}}(e,t),o=g()(n.maps||[]),i=g()(n.documents||[]);return y.Observable.defer((function(){return b.A.all([o.length>0?(0,j.iu)(o).then((function(t){return t})).catch((function(){return[]})):Promise.resolve([]),i.length>0?(0,j.lD)(i).then((function(t){return t})).catch((function(){return[]})):Promise.resolve([])]).then((function(t){var r,e,n=(e=2,function(t){if(Array.isArray(t))return t}(r=t)||function(t,r){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var n,o,i,a,u=[],c=!0,l=!1;try{if(i=(e=e.call(t)).next,0===r){if(Object(e)!==e)return;c=!1}else for(;!(c=(n=i.call(e)).done)&&(u.push(n.value),u.length!==r);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=e.return&&(a=e.return(),Object(a)!==a))return}finally{if(l)throw o}}return u}}(r,e)||C(r,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=n[0],u=n[1];return[].concat(D(o.map((function(t){var r=a.find((function(r){return r.pk===t}));return r?{data:r,status:"success",title:r.title}:{status:"error",title:"map/".concat(t)}}))),D(i.map((function(t){var r=u.find((function(r){return r.pk===t}));return r?{data:r,status:"success",title:r.title}:{status:"error",title:"document/".concat(t)}}))))}))})).switchMap((function(r){var n,o,i=r.filter((function(t){return"error"===t.status})),a=r.filter((function(t){return"success"===t.status})),u=function(){if(0===a.length)return[];if("geostory"===e)return a.map((function(t){var r=t.data,e=N("geostory",r),n=e.type,o=e.data;return(0,S.TP)(r.pk,n,o)}));if("dashboard"===e){var r=(0,k.R$)(t),n=N("dashboard",r,a).data;return[(0,T.Ik)((0,k.N9)(t),n)]}return[]}(),c=function(t,r,e){var n="Success";return t>0&&r>0?n="Warning":0===t&&r>0?n="Success":t>0&&0===r&&(n="Error"),{level:n.toLowerCase(),title:"gnviewer.sync".concat(n).concat("Warning"!==n?e:"","Title"),message:"gnviewer.sync".concat(n,"Message")}}(i.length,a.length,e),l=c.level,s=c.title,f=c.message;return y.Observable.of.apply(y.Observable,D(u).concat([(0,O.Tw)(),(0,P.WU)({title:s,message:f,values:{successTitles:null===(n=a.map((function(t){return t.title})))||void 0===n?void 0:n.join(", "),errorTitles:null===(o=i.map((function(t){return t.title})))||void 0===o?void 0:o.join(", ")}},l)]))})).catch((function(t){var r,e;return y.Observable.of((0,O.Tw)(),(0,P.z3)({title:"gnviewer.syncErrorTitle",message:(null==t||null===(r=t.data)||void 0===r?void 0:r.detail)||(null==t||null===(e=t.originalError)||void 0===e?void 0:e.message)||(null==t?void 0:t.message)||"gnviewer.syncErrorDefault"}))})).startWith((0,O.RZ)())}))}};function W(t){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},W(t)}function x(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),e.push.apply(e,n)}return e}function U(t,r,e){return(r=function(t){var r=function(t){if("object"!=W(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var e=r.call(t,"string");if("object"!=W(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==W(r)?r:r+""}(r))in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}function $(t){var r=t.synchronize,e=t.enabled,n=t.size;return e&&o().createElement(f.A,{variant:"primary",size:n,onClick:function(){return r()}},o().createElement(s.A,{msgId:"gnviewer.sync"}))}$.contextTypes={synchronize:a().func};var B=(0,u.connect)((0,c.Mz)(p.M3,(function(t){return{enabled:t}})),{synchronize:function(){return{type:h}}})($);const G=(0,l.i1)("Sync",{component:B,containers:{ActionNavbar:{name:"Sync",priority:1}},epics:function(t){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{};r%2?x(Object(e),!0).forEach((function(r){U(t,r,e[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):x(Object(e)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}))}return t}({},R),reducers:{}})}}]);