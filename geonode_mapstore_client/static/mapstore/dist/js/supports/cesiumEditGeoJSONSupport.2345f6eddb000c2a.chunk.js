"use strict";(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[51130],{637423:(i,e,t)=>{t.r(e),t.d(e,{default:()=>B});var n=t(273517),o=t(336946),r=t(86881),a=t(149785),l=t(493721),s=t(770103),c=t(623e3),d=t(124547),u=t(842153),v=t(433052),f=t(367817),h=t(457378),m=t(762222),y=t(407350),p=t.n(y),g=t(185015),_=t.n(g),b=t(770260),A=t(305493);function P(i){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},P(i)}function w(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,T(n.key),n)}}function I(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable})),t.push.apply(t,n)}return t}function C(i){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?I(Object(t),!0).forEach(function(e){O(i,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):I(Object(t)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(t,e))})}return i}function O(i,e,t){return(e=T(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function T(i){var e=function(i){if("object"!=P(i)||!i)return i;var e=i[Symbol.toPrimitive];if(void 0!==e){var t=e.call(i,"string");if("object"!=P(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}(i);return"symbol"==P(e)?e:e+""}function E(i){return function(i){if(Array.isArray(i))return S(i)}(i)||function(i){if("undefined"!=typeof Symbol&&null!=i[Symbol.iterator]||null!=i["@@iterator"])return Array.from(i)}(i)||D(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(i,e){if(i){if("string"==typeof i)return S(i,e);var t={}.toString.call(i).slice(8,-1);return"Object"===t&&i.constructor&&(t=i.constructor.name),"Map"===t||"Set"===t?Array.from(i):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?S(i,e):void 0}}function S(i,e){(null==e||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function N(i,e){var t;if(null===(null==e?void 0:e.geometry))return null;var n=e.geometry,r=void 0===n?{}:n,a=r.coordinates,l=void 0===a?[]:a;switch(i||(null==r?void 0:r.type)){case"Point":case"Circle":return[o.A.toCartesian((t=o.A).fromDegrees.apply(t,E(l)))];case"LineString":return l.map(function(i){var e;return o.A.toCartesian((e=o.A).fromDegrees.apply(e,E(i)))});case"Polygon":return l[0].map(function(i){var e;return o.A.toCartesian((e=o.A).fromDegrees.apply(e,E(i)))});default:return null}}function k(i){return i.map(function(i){var e,t,n=(t=3,function(i){if(Array.isArray(i))return i}(e=i)||function(i,e){var t=null==i?null:"undefined"!=typeof Symbol&&i[Symbol.iterator]||i["@@iterator"];if(null!=t){var n,o,r,a,l=[],s=!0,c=!1;try{if(r=(t=t.call(i)).next,0===e){if(Object(t)!==t)return;s=!1}else for(;!(s=(n=r.call(t)).done)&&(l.push(n.value),l.length!==e);s=!0);}catch(i){c=!0,o=i}finally{try{if(!s&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||D(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=n[0],r=n[1],a=n[2];return[o,r,void 0===a?0:a]})}function j(i,e){if(null===(null==i?void 0:i.geometry))return i;var t=i.geometry,n=void 0===t?{}:t;switch(null==n?void 0:n.type){case"Point":return C(C({},i),{},{geometry:{type:"Point",coordinates:k([i.geometry.coordinates].reduce(e,[]))[0]}});case"LineString":return C(C({},i),{},{geometry:{type:"LineString",coordinates:k(i.geometry.coordinates.reduce(e,[]))}});case"Polygon":return C(C({},i),{},{geometry:{type:"Polygon",coordinates:[k(i.geometry.coordinates[0].reduce(e,[]))]}});default:return i}}const F=function(){return i=function i(){var e,t,n,o,d,u=this,v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this._map=v.map,this._getPositionInfo=v.getPositionInfo?v.getPositionInfo:function(i){var e=i.position||i.endPosition,t=u._map.scene.drillPick(e),n=(0,b.hm)(u._map,i);return{intersected:t,cartesian:n.cartesian,cartographic:n.cartographic}},this._handler=new r.A(this._map.canvas),this._handler.setInputAction(function(i){u._handleEdit(i,!0)},a.A.LEFT_DOUBLE_CLICK),this._handler.setInputAction(function(i){u._handleEdit(i)},a.A.LEFT_CLICK),this._handler.setInputAction(p()(function(i){u._handleMouseMove(i)},null!==(e=v.mouseMoveThrottleTime)&&void 0!==e?e:100),a.A.MOUSE_MOVE),this._staticPrimitivesCollection=new l.A({destroyPrimitives:!0}),this._map.scene.primitives.add(this._staticPrimitivesCollection),this._staticBillboardCollection=new s.A({scene:this._map.scene}),this._map.scene.primitives.add(this._staticBillboardCollection),this._dynamicPrimitivesCollection=new l.A({destroyPrimitives:!0}),this._map.scene.primitives.add(this._dynamicPrimitivesCollection),this._dynamicBillboardCollection=new s.A({scene:this._map.scene}),this._map.scene.primitives.add(this._dynamicBillboardCollection),this._style=(0,A.zY)(v.style),this._cursorImage=(0,h.g7)(2*(null===(t=this._style)||void 0===t||null===(t=t.cursor)||void 0===t?void 0:t.radius),{stroke:"#ffffff",strokeWidth:null===(n=this._style)||void 0===n||null===(n=n.cursor)||void 0===n?void 0:n.width,fill:"rgba(0, 0, 0, 0)"}),this._coordinateNodeImage=(0,h.g7)(2*(null===(o=this._style)||void 0===o||null===(o=o.coordinatesNode)||void 0===o?void 0:o.radius),{stroke:"#ffffff",strokeWidth:null===(d=this._style)||void 0===d||null===(d=d.coordinatesNode)||void 0===d?void 0:d.width,fill:"rgba(0, 0, 0, 0.1)"}),this._editing=!1,this._onKeyboardEvent=function(i){var e;"Escape"===i.code&&u._editing&&(u._editing=!1,u._dynamicPrimitivesCollection.removeAll(),u._dynamicBillboardCollection.removeAll()),null!==(e=u._map)&&void 0!==e&&e.scene&&!u._map.isDestroyed()&&u._map.scene.requestRender()},window.addEventListener("keydown",this._onKeyboardEvent),this._featureToModifyProperties=(0,A.Nv)({getGeometryType:null==v?void 0:v.getGeometryType}),this._modifyPropertiesToFeatureProperties=A.Or,this._onEditEnd=null!=v&&v.onEditEnd?v.onEditEnd:function(){},this.setGeoJSON((null==v?void 0:v.geojson)||[]),c.A.initializeTerrainHeights().then(function(){u._drawStaticFeatures()})},(e=[{key:"setGeoJSON",value:function(i){var e=this;this._features=i?("Feature"===(null==i?void 0:i.type)?[i]:null==i?void 0:i.features).map(function(i){return C(C({},i),{},{properties:e._featureToModifyProperties(i)})}):[],this._geojson=C({},i),this._drawStaticFeatures()}},{key:"remove",value:function(){var i;this._handler&&(this._handler.destroy(),this._handler=null),this._editing=!1,this._onKeyboardEvent&&window.removeEventListener("keydown",this._onKeyboardEvent),null!==(i=this._map)&&void 0!==i&&i.isDestroyed&&!this._map.isDestroyed()&&((0,h.IP)(this._map,this._staticPrimitivesCollection),this._staticPrimitivesCollection=null,(0,h.IP)(this._map,this._staticBillboardCollection),this._staticBillboardCollection=null,(0,h.IP)(this._map,this._dynamicPrimitivesCollection),this._dynamicPrimitivesCollection=null,(0,h.IP)(this._map,this._dynamicBillboardCollection),this._dynamicBillboardCollection=null)}},{key:"_drawStaticFeatures",value:function(){var i,e,t,n=this;null===(i=this._staticBillboardCollection)||void 0===i||i.removeAll(),null===(e=this._staticPrimitivesCollection)||void 0===e||e.removeAll(),(null===(t=this._features)||void 0===t?void 0:t.length)>0&&this._features.forEach(function(i){n._updatePrimitives(i)})}},{key:"_updatePrimitives",value:function(i){var e,t,n=this,o=(null==i?void 0:i.properties)||{},r=o.geometryType,a=o.geodesic,l=o.radius,s=N(r,i);if(s)switch(r){case"Circle":var c,d,u,v,f;this._staticBillboardCollection.add({id:null==i?void 0:i.id,position:s[s.length-1],image:this._coordinateNodeImage,color:(0,h.Oe)(C({},null===(e=this._style)||void 0===e?void 0:e.coordinatesNode)),disableDepthTestDistance:Number.POSITIVE_INFINITY}),a?(this._staticPrimitivesCollection.add((0,h.Ac)(C(C({},null===(c=this._style)||void 0===c?void 0:c.areaDrawing),{},{coordinates:s[s.length-1],radius:l,clampToGround:!0}))),this._staticPrimitivesCollection.add((0,h.wm)(C(C({},null===(d=this._style)||void 0===d?void 0:d.lineDrawing),{},{dashLength:void 0,opacity:.01,coordinates:s[s.length-1],radius:l,allowPicking:!0,id:null==i?void 0:i.id,geodesic:!0}))),this._staticPrimitivesCollection.add((0,h.wm)(C(C({},null===(u=this._style)||void 0===u?void 0:u.lineDrawing),{},{coordinates:s[s.length-1],radius:l,allowPicking:!1,geodesic:!0})))):(this._staticPrimitivesCollection.add((0,h.Os)(C(C({},null===(v=this._style)||void 0===v?void 0:v.areaDrawing),{},{coordinates:s[s.length-1],radius:l}))),this._staticPrimitivesCollection.add((0,h.cp)(C(C({},null===(f=this._style)||void 0===f?void 0:f.lineDrawing),{},{coordinates:s[s.length-1],allowPicking:!0,id:null==i?void 0:i.id,radius:l}))));break;case"Point":this._staticBillboardCollection.add({id:null==i?void 0:i.id,position:s[s.length-1],image:this._coordinateNodeImage,color:(0,h.Oe)(C({},null===(t=this._style)||void 0===t?void 0:t.coordinatesNode)),disableDepthTestDistance:Number.POSITIVE_INFINITY});break;case"LineString":s.length>1&&s.forEach(function(e,t){var o,r,l;s[t+1]&&(n._staticPrimitivesCollection.add((0,h.Qi)(C(C({},null===(r=n._style)||void 0===r?void 0:r.lineDrawing),{},{dashLength:void 0,opacity:.01,coordinates:[e,s[t+1]],allowPicking:!0,id:"".concat(null==i?void 0:i.id,":").concat(t,":segment"),geodesic:a}))),n._staticPrimitivesCollection.add((0,h.Qi)(C(C({},null===(l=n._style)||void 0===l?void 0:l.lineDrawing),{},{coordinates:[e,s[t+1]],allowPicking:!1,geodesic:a})))),n._staticBillboardCollection.add({id:"".concat(null==i?void 0:i.id,":").concat(t,":vertex"),position:e,image:n._coordinateNodeImage,color:(0,h.Oe)(C({},null===(o=n._style)||void 0===o?void 0:o.coordinatesNode)),disableDepthTestDistance:Number.POSITIVE_INFINITY})});break;case"Polygon":var m;s.length>2&&(this._staticPrimitivesCollection.add((0,h.ge)(C(C({},null===(m=this._style)||void 0===m?void 0:m.areaDrawing),{},{coordinates:E(s),geodesic:a}))),s.forEach(function(e,t){var o,r,l;s[t+1]&&(n._staticPrimitivesCollection.add((0,h.Qi)(C(C({},null===(r=n._style)||void 0===r?void 0:r.lineDrawing),{},{dashLength:void 0,opacity:.01,coordinates:[e,s[t+1]],allowPicking:!0,id:"".concat(null==i?void 0:i.id,":").concat(t,":segment"),geodesic:a}))),n._staticPrimitivesCollection.add((0,h.Qi)(C(C({},null===(l=n._style)||void 0===l?void 0:l.lineDrawing),{},{coordinates:[e,s[t+1]],allowPicking:!1,geodesic:a})))),n._staticBillboardCollection.add({id:"".concat(null==i?void 0:i.id,":").concat(t,":vertex"),position:e,image:n._coordinateNodeImage,color:(0,h.Oe)(C({},null===(o=n._style)||void 0===o?void 0:o.coordinatesNode)),disableDepthTestDistance:Number.POSITIVE_INFINITY})}))}this._map.scene.requestRender()}},{key:"_getPrimitiveFeatureId",value:function(i){return(_()(i)?(i||"").split(":"):[])[0]}},{key:"_getIntersectedInfo",value:function(i){var e=this,t=this._getPositionInfo(i),n=t.cartesian,o=t.cartographic,r=t.intersected.find(function(i){var t=e._getPrimitiveFeatureId(i.id),n=t&&e._features.find(function(i){return(null==i?void 0:i.id)===t});return!!(n&&i.primitive instanceof d.A)||!!(n&&i.primitive instanceof u.A)||!!(n&&i.primitive instanceof v.A)})||{},a=r.id;return{cartesian:n,cartographic:o,primitive:r.primitive,id:a}}},{key:"_normalizeGeoJSONResult",value:function(i){var e,t,n=E("Feature"===(null===(e=this._geojson)||void 0===e?void 0:e.type)?[this._geojson]:this._geojson.features).map(i);return"Feature"===(null===(t=this._geojson)||void 0===t?void 0:t.type)?n[0]:{type:"FeatureCollection",features:n}}},{key:"_handleOnEditEnd",value:function(i){var e=this,t=this._normalizeGeoJSONResult(function(t){return t.id===(null==i?void 0:i.id)?C(C({},t),{},{geometry:i.geometry,properties:e._modifyPropertiesToFeatureProperties(null==i?void 0:i.properties,t)}):t});return this._onEditEnd(t)}},{key:"_getSingleLinStringGeometry",value:function(){var i,e;return 1===(null===(i=this._features)||void 0===i?void 0:i.length)&&"LineString"===(null===(e=this._features[0])||void 0===e||null===(e=e.geometry)||void 0===e?void 0:e.type)&&this._features[0]}},{key:"_handleMouseMove",value:function(i){var e=this;this._dynamicPrimitivesCollection.removeAll(),this._dynamicBillboardCollection.removeAll();var t,n,r=this._getIntersectedInfo(i),a=r.primitive,l=r.cartesian,s=this._getPrimitiveFeatureId(this._editing?this._editing.id:r.id),c=s&&this._features.find(function(i){return i.id===s}),y=(null==c?void 0:c.properties)||{},p=y.geometryType,g=y.radius,_=y.geodesic;if(this._editing){var b,A,P;if(["Point","Circle"].includes(p)&&this._editing.primitive instanceof d.A&&(this._dynamicBillboardCollection.add({position:l,image:this._coordinateNodeImage,color:(0,h.Oe)(C({},null===(b=this._style)||void 0===b?void 0:b.cursor)),disableDepthTestDistance:Number.POSITIVE_INFINITY}),"Circle"===p&&this._dynamicPrimitivesCollection.add(_?(0,h.Ac)(C(C({},null===(A=this._style)||void 0===A?void 0:A.area),{},{coordinates:l,radius:g,clampToGround:!0})):(0,h.Os)(C(C({},null===(P=this._style)||void 0===P?void 0:P.areaDrawing),{},{coordinates:l,radius:g}))),_)){var w,I,O=(0,m.qg)([l]);this._dynamicPrimitivesCollection.add((0,h.Qi)(C(C({},null===(w=this._style)||void 0===w?void 0:w.wireframe),{},{coordinates:[O[0],l]}))),this._dynamicBillboardCollection.add({position:O[0],image:this._coordinateNodeImage,color:(0,h.Oe)(C({},null===(I=this._style)||void 0===I?void 0:I.coordinatesNode)),disableDepthTestDistance:Number.POSITIVE_INFINITY})}if("Circle"===p&&(this._editing.primitive instanceof v.A||this._editing.primitive instanceof u.A)){var T,D=o.A.toCartesian(new o.A(f.A.toRadians(c.geometry.coordinates[0]),f.A.toRadians(c.geometry.coordinates[1]),null!==(T=c.geometry.coordinates[2])&&void 0!==T?T:0)),S=(0,m.Ht)([D,l],_);if(_){var k,j,F,B,L,Q,G,M=(0,m.qg)([D,l],function(i){var e;return null===(e=i[i.length-1])||void 0===e?void 0:e.height}),R=(0,m.qg)([D,l]);this._dynamicPrimitivesCollection.add((0,h.Ac)(C(C({},null===(k=this._style)||void 0===k?void 0:k.area),{},{coordinates:D,radius:S,clampToGround:!0}))),this._dynamicPrimitivesCollection.add((0,h.wm)(C(C({},null===(j=this._style)||void 0===j?void 0:j.wireframe),{},{coordinates:M[0],radius:S,geodesic:!0}))),this._dynamicPrimitivesCollection.add((0,h.wm)(C(C({},null===(F=this._style)||void 0===F?void 0:F.lineDrawing),{},{coordinates:R[0],radius:S,geodesic:!0}))),this._dynamicBillboardCollection.add({position:D,image:this._cursorImage,color:(0,h.Oe)(C({},null===(B=this._style)||void 0===B?void 0:B.cursor)),disableDepthTestDistance:Number.POSITIVE_INFINITY}),this._dynamicBillboardCollection.add({position:M[0],image:this._cursorImage,color:(0,h.Oe)(C({},null===(L=this._style)||void 0===L?void 0:L.cursor)),disableDepthTestDistance:Number.POSITIVE_INFINITY}),this._dynamicBillboardCollection.add({position:R[0],image:this._cursorImage,color:(0,h.Oe)(C({},null===(Q=this._style)||void 0===Q?void 0:Q.cursor)),disableDepthTestDistance:Number.POSITIVE_INFINITY}),this._dynamicPrimitivesCollection.add((0,h.Qi)(C(C({},null===(G=this._style)||void 0===G?void 0:G.wireframe),{},{geodesic:!0,coordinates:[D,R[0],R[1],M[1],M[0]]})))}else{var V,Y;this._dynamicPrimitivesCollection.add((0,h.cp)(C(C({},null===(V=this._style)||void 0===V?void 0:V.lineDrawing),{},{coordinates:D,radius:S}))),this._dynamicPrimitivesCollection.add((0,h.Qi)(C(C({},null===(Y=this._style)||void 0===Y?void 0:Y.wireframe),{},{coordinates:[D,l]})))}}if(["LineString","Polygon"].includes(p)&&this._editing.primitive instanceof d.A){var q,z=parseFloat(this._editing.id.split(":")[1]),x=N(p,c),K=[].concat(E(x[z-1]?[x[z-1]]:"Polygon"===p?[x[x.length-2]]:[]),[l],E(x[z+1]?[x[z+1]]:"Polygon"===p?[x[1]]:[]));if(this._dynamicBillboardCollection.add({position:l,image:this._coordinateNodeImage,color:(0,h.Oe)(C({},null===(q=this._style)||void 0===q?void 0:q.cursor)),disableDepthTestDistance:Number.POSITIVE_INFINITY}),_){var U,H,J=o.A.fromCartesian(l).height,W=(0,m.qg)(K,function(){return J}),X=(0,m.qg)(K);this._dynamicPrimitivesCollection.add((0,h.Qi)(C(C({},null===(U=this._style)||void 0===U?void 0:U.wireframe),{},{geodesic:_,coordinates:E(W)}))),this._dynamicPrimitivesCollection.add((0,h.Qi)(C(C({},null===(H=this._style)||void 0===H?void 0:H.lineDrawing),{},{geodesic:_,coordinates:E(X)}))),W.forEach(function(i,t){var n;e._dynamicPrimitivesCollection.add((0,h.Qi)(C(C({},null===(n=e._style)||void 0===n?void 0:n.wireframe),{},{geodesic:_,coordinates:[X[t],W[t]]})))})}else{var $;this._dynamicPrimitivesCollection.add((0,h.Qi)(C(C({},null===($=this._style)||void 0===$?void 0:$.lineDrawing),{},{coordinates:K})))}}if(["LineString","Polygon"].includes(p)&&this._editing.primitive instanceof u.A){var Z,ii=parseFloat(this._editing.id.split(":")[1]),ei=N(p,c),ti=[].concat(E(ei[ii]?[ei[ii]]:[]),[l],E(ei[ii+1]?[ei[ii+1]]:[]));if(this._dynamicBillboardCollection.add({position:l,image:this._coordinateNodeImage,color:(0,h.Oe)(C({},null===(Z=this._style)||void 0===Z?void 0:Z.cursor)),disableDepthTestDistance:Number.POSITIVE_INFINITY}),_){var ni,oi,ri=o.A.fromCartesian(l).height,ai=(0,m.qg)(ti,function(){return ri}),li=(0,m.qg)(ti);this._dynamicPrimitivesCollection.add((0,h.Qi)(C(C({},null===(ni=this._style)||void 0===ni?void 0:ni.wireframe),{},{geodesic:_,coordinates:E(ai)}))),this._dynamicPrimitivesCollection.add((0,h.Qi)(C(C({},null===(oi=this._style)||void 0===oi?void 0:oi.lineDrawing),{},{geodesic:_,coordinates:E(li)}))),ai.forEach(function(i,t){var n;e._dynamicPrimitivesCollection.add((0,h.Qi)(C(C({},null===(n=e._style)||void 0===n?void 0:n.wireframe),{},{geodesic:_,coordinates:[li[t],ai[t]]})))})}else{var si;this._dynamicPrimitivesCollection.add((0,h.Qi)(C(C({},null===(si=this._style)||void 0===si?void 0:si.lineDrawing),{},{coordinates:[].concat(E(ei[ii]?[ei[ii]]:[]),[l],E(ei[ii+1]?[ei[ii+1]]:[]))})))}}var ci=this._getSingleLinStringGeometry();if(!this._editing.primitive&&ci&&l){var di,ui,vi=N(p,ci);if(null==ci||null===(di=ci.properties)||void 0===di?void 0:di.geodesic){var fi,hi,mi=[vi[vi.length-1],l],yi=(0,m.qg)(mi,function(i){var e;return null===(e=i[i.length-1])||void 0===e?void 0:e.height}),pi=(0,m.qg)(mi);this._dynamicPrimitivesCollection.add((0,h.Qi)(C(C({},null===(fi=this._style)||void 0===fi?void 0:fi.wireframe),{},{geodesic:!0,coordinates:E(yi)}))),this._dynamicPrimitivesCollection.add((0,h.Qi)(C(C({},null===(hi=this._style)||void 0===hi?void 0:hi.lineDrawing),{},{geodesic:!0,coordinates:E(pi)}))),yi.forEach(function(i,t){var n;e._dynamicPrimitivesCollection.add((0,h.Qi)(C(C({},null===(n=e._style)||void 0===n?void 0:n.wireframe),{},{geodesic:!0,coordinates:[pi[t],yi[t]]})))})}else{var gi;this._dynamicPrimitivesCollection.add((0,h.Qi)(C(C({},null===(gi=this._style)||void 0===gi?void 0:gi.lineDrawing),{},{coordinates:[vi[vi.length-1],l]})))}this._dynamicBillboardCollection.add({position:l,image:this._coordinateNodeImage,color:(0,h.Oe)(C({},null===(ui=this._style)||void 0===ui?void 0:ui.cursor)),disableDepthTestDistance:Number.POSITIVE_INFINITY})}return this._map.scene.requestRender(),null}return a instanceof d.A&&this._dynamicBillboardCollection.add({position:a.position,image:this._cursorImage,color:(0,h.Oe)(C({},null===(t=this._style)||void 0===t?void 0:t.cursor)),disableDepthTestDistance:Number.POSITIVE_INFINITY}),(a instanceof u.A||a instanceof v.A)&&this._dynamicBillboardCollection.add({position:l,image:this._cursorImage,color:(0,h.Oe)(C({},null===(n=this._style)||void 0===n?void 0:n.cursor)),disableDepthTestDistance:Number.POSITIVE_INFINITY}),this._map.scene.requestRender(),null}},{key:"_handleEdit",value:function(i,e){var t=this._getIntersectedInfo(i),n=this._getPrimitiveFeatureId(this._editing?this._editing.id:t.id),r=n&&this._features.find(function(i){return i.id===n}),a=(null==r?void 0:r.properties)||{},l=a.geometryType,s=a.geodesic;if(this._editing){this._dynamicPrimitivesCollection.removeAll(),this._dynamicBillboardCollection.removeAll();var c=this._editing.primitive,h=this._editing.id;this._editing=!1;var y=t.cartographic,p=t.cartesian,g=y&&[f.A.toDegrees(y.longitude),f.A.toDegrees(y.latitude),s?0:y.height];if(["Circle","Point"].includes(l)&&g&&c instanceof d.A)return this._handleOnEditEnd(j(r,function(i){return[].concat(E(i),[g])}));if("Circle"===l&&g&&(c instanceof v.A||c instanceof u.A)){var _,b=o.A.toCartesian(new o.A(f.A.toRadians(r.geometry.coordinates[0]),f.A.toRadians(r.geometry.coordinates[1]),null!==(_=r.geometry.coordinates[2])&&void 0!==_?_:0)),A=(0,m.Ht)([b,p],s);return this._handleOnEditEnd(C(C({},r),{},{properties:C(C({},null==r?void 0:r.properties),{},{radius:A})}))}if("Polygon"===l&&g&&c instanceof d.A){var P=parseFloat(h.split(":")[1]),w=function(i){return 0===P||P===i.length-1?[0,i.length-1]:[P]};return this._handleOnEditEnd(j(r,function(i,e,t,n){return[].concat(E(i),[w(n).includes(t)?g:e])}))}if(g&&c instanceof d.A){var I=parseFloat(h.split(":")[1]);return this._handleOnEditEnd(j(r,function(i,e,t){return[].concat(E(i),[t===I?g:e])}))}if(g&&c instanceof u.A){var O=parseFloat(h.split(":")[1]);return this._handleOnEditEnd(j(r,function(i,e,t){return[].concat(E(i),[e],E(t===O?[g]:[]))}))}var T=this._getSingleLinStringGeometry();if(g&&!c&&T){var D,S=[g[0],g[1],null!=T&&null!==(D=T.properties)&&void 0!==D&&D.geodesic?0:g[2]];return e?this._handleOnEditEnd(j(T,function(i,e,t,n){return[].concat(E(i),E(t<n.length-1?[e]:[]))})):(this._editing={id:h},this._handleOnEditEnd(j(T,function(i,e,t,n){return[].concat(E(i),[e],E(t===n.length-1?[S]:[]))})))}}else this._editing=t,t.primitive||this._getSingleLinStringGeometry()||(this._editing=!1);return null}}])&&w(i.prototype,e),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,e}(),B=function(i){var e=i.map,t=i.active,o=i.geojson,r=i.onEditEnd,a=i.getGeometryType,l=i.style,s=i.getPositionInfo,c=(0,n.useRef)();return(0,n.useEffect)(function(){return null!=e&&e.canvas&&t&&(c.current=new F({map:e,geojson:o,getGeometryType:a,onEditEnd:r,style:l,getPositionInfo:s})),function(){c.current&&(c.current.remove(),c.current=null)}},[e,t]),(0,n.useEffect)(function(){c.current&&c.current.setGeoJSON(o)},[o]),null}},305493:(i,e,t)=>{function n(i){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},n(i)}function o(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable})),t.push.apply(t,n)}return t}function r(i){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?o(Object(t),!0).forEach(function(e){a(i,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(t,e))})}return i}function a(i,e,t){return(e=function(i){var e=function(i){if("object"!=n(i)||!i)return i;var e=i[Symbol.toPrimitive];if(void 0!==e){var t=e.call(i,"string");if("object"!=n(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}(i);return"symbol"==n(e)?e:e+""}(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function l(i){return r({wireframe:{color:"#000000",opacity:1,depthFailColor:"#000000",depthFailOpacity:.4,width:.5},lineDrawing:{color:"#000000",opacity:1,depthFailColor:"#000000",depthFailOpacity:.4,width:3,dashLength:8},line:{color:"#ffcc33",opacity:1,depthFailColor:"#ffcc33",depthFailOpacity:.4,width:2},areaDrawing:{color:"#ffffff",opacity:.5,depthFailColor:"#ffffff",depthFailOpacity:.25},area:{color:"#ffffff",opacity:.5,depthFailColor:"#ffffff",depthFailOpacity:.25},cursor:{color:"#ff0000",width:2,radius:4},coordinatesNode:{color:"#333333",width:2,radius:5}},i)}t.d(e,{Nv:()=>c,Or:()=>d,zY:()=>l});var s=function(i){var e;return null==i||null===(e=i.geometry)||void 0===e?void 0:e.type},c=function(){var i=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).getGeometryType,e=void 0===i?s:i;return function(i){return r(r({},null==i?void 0:i.properties),{},{geometryType:e(i)})}},d=function(i,e){return r(r({},null==e?void 0:e.properties),void 0!==(null==i?void 0:i.radius)&&{radius:i.radius})}},770260:(i,e,t)=>{t.d(e,{Ay:()=>s,hm:()=>l});var n=t(336946),o=t(491446),r=t(623e3),a=t(433052);function l(i,e){var t=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).pickObjectsLimit,o=void 0===t?Number.MAX_VALUE:t,l=i.scene,s=i.camera,c=e.position||e.endPosition,d=l.pick(c),u=l.pickPosition(c);if(!((null==d?void 0:d.primitive)instanceof r.A)&&!((null==d?void 0:d.primitive)instanceof a.A)&&d&&u)return{cartesian:u,cartographic:n.A.fromCartesian(u),feature:d};var v,f=s.getPickRay(c),h=l.drillPickFromRay(f,o).find(function(i){var e=i.exclude,t=i.object,n=i.position;return!e&&n&&t})||null;if(h)return{cartesian:h.position,cartographic:n.A.fromCartesian(h.position),feature:null==h||null===(v=h.object)||void 0===v?void 0:v.primitive};var m=l.globe.pick(f,l);return m?{cartesian:m,cartographic:n.A.fromCartesian(m)}:{}}const s={getMouseXYZ:function(i,e){var t=i.scene,r=e.position||e.endPosition;if(!r)return null;if(i.scene.drillPick(r).find(function(i){var e;return!(!1===(null==i||null===(e=i.id)||void 0===e||null===(e=e.entityCollection)||void 0===e||null===(e=e.owner)||void 0===e?void 0:e.queryable))})){var a=t.globe.depthTestAgainstTerrain,l=t.pickTranslucentDepth;t.globe.depthTestAgainstTerrain=!0,t.pickTranslucentDepth=!0;var s=t.pickPosition(r);if(t.globe.depthTestAgainstTerrain=a,t.pickTranslucentDepth=l,s)return n.A.fromCartesian(s)}var c=i.camera.getPickRay(r),d=i.scene.globe.pick(c,i.scene),u=t._globe.ellipsoid;if(o.A(d)){var v=u.cartesianToCartographic(d),f=function(i,e){if(null!==e.position){var t=i.scene,n=t._globe.ellipsoid;return t.camera.pickEllipsoid(e.position||e.endPosition,n)}return null}(i,e);return f&&(v.height=t._globe.getHeight(v),v.cartesian=f,v.position=d),v}return null},getMouseTile:function(i,e){var t=i.scene;if(!e.position)return null;var n=i.camera.getPickRay(e.position);return i.scene.globe.pickTile(n,t)}}},762222:(i,e,t)=>{t.d(e,{Ht:()=>b,Kf:()=>P,L8:()=>y,Lj:()=>h,Ot:()=>m,Q2:()=>p,TS:()=>f,Vf:()=>g,_U:()=>A,qg:()=>w});var n=t(267980),o=t(367817),r=t(434067),a=t(336946),l=t(602289),s=t(466570),c=t.n(s);function d(i,e){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,e){return i.__proto__=e,i},d(i,e)}function u(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(i){}return(u=function(){return!!i})()}function v(i,e){(null==e||e>i.length)&&(e=i.length);for(var t=0,n=Array(e);t<e;t++)n[t]=i[t];return n}function f(i,e){var t=n.A.subtract(e,i,new n.A),o=n.A.multiplyByScalar(t,.5,new n.A);return n.A.add(i,o,new n.A)}function h(i,e){var t=n.A.normalize(i,new n.A),r=n.A.normalize(e,new n.A),a=n.A.dot(t,r);return o.A.toDegrees(Math.acos(a))}function m(i){return i.map(function(e,t){var o=i[t-1],r=i[t+1];return o&&r?h(n.A.subtract(o,e,new n.A),n.A.subtract(r,e,new n.A)):null}).filter(function(i){return null!==i})}function y(i){return new n.A((i[0].x+i[1].x+i[2].x)/3,(i[0].y+i[1].y+i[2].y)/3,(i[0].z+i[1].z+i[2].z)/3)}function p(i,e){return i.map(function(t,o){var r=i[o-1],a=i[o+1];if(r&&a){var l=function(i,e){var t=n.A.normalize(i,new n.A),o=n.A.normalize(e,new n.A);return n.A.cross(t,o,new n.A)}(n.A.subtract(r,t,new n.A),n.A.subtract(a,t,new n.A)),s=-Math.sign(n.A.dot(l,n.A.subtract(t,e,new n.A),new n.A));return h(n.A.multiplyByScalar(l,s,new n.A),t)}return null}).filter(function(i){return null!==i})}function g(i,e){if((null==i?void 0:i.length)<3)return 0;for(var t=r.A.packArray(i),o=c()(t,e,2),a=0,l=0;l<o.length;l+=3){var s=i[o[l]],d=i[o[l+1]],u=i[o[l+2]],v=n.A.subtract(d,s,new n.A),f=n.A.subtract(u,s,new n.A),h=n.A.cross(v,f,new n.A);a+=n.A.magnitude(h)/2}return a}function _(i,e){var t,n=[i,e].map(function(i){return a.A.fromCartesian(i)});return function(i,e,t){if(u())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var o=new(i.bind.apply(i,n));return t&&d(o,t.prototype),o}(l.A,(t=n.map(function(i){var e=i.longitude,t=i.latitude;return new a.A(e,t,0)}),function(i){if(Array.isArray(i))return v(i)}(t)||function(i){if("undefined"!=typeof Symbol&&null!=i[Symbol.iterator]||null!=i["@@iterator"])return Array.from(i)}(t)||function(i,e){if(i){if("string"==typeof i)return v(i,e);var t={}.toString.call(i).slice(8,-1);return"Object"===t&&i.constructor&&(t=i.constructor.name),"Map"===t||"Set"===t?Array.from(i):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?v(i,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())).surfaceDistance}function b(i,e){return(null==i?void 0:i.length)<2?0:i.reduce(function(t,o,r){return i[r-1]?t+(e?_(o,i[r-1]):n.A.distance(o,i[r-1])):t},0)}function A(i){return Math.sign(a.A.fromCartesian(i[1]).height-a.A.fromCartesian(i[0]).height)}function P(i,e){var t=a.A.fromCartesian(i),n=t.longitude,r=t.latitude,l=t.height;return[o.A.toDegrees(n),o.A.toDegrees(r),null!=e?e:l]}function w(i,e){var t=i.map(function(i){return a.A.fromCartesian(i)}),n=e?e(t):0;return t.map(function(i){var e=i.longitude,t=i.latitude;return a.A.toCartesian(new a.A(e,t,n))})}}}]);